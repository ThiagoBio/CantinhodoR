## Cantinho do R
### Um boxplot com médias

ou, se preferir:

### Aprendendo como montar um gráfico do zero no R

*Marcos V. C. Vital*

Para mais material, acesse <http://cantinhodor.wordpress.com/>

\ 

Este documento faz parte do material que disponibilizo no meu blog, o "Cantinho do R", e foi  foi criado utilizando o software R, o programa RStudio e a linguagem Markdown. Para saber mais sobre eles, acesse:

<http://www.r-project.org/>

<http://www.rstudio.com>

<http://rmarkdown.rstudio.com/>

\ 

Se Você está olhando este documento e não consegue entender nada, é sinal de que tem que começar do básico com o R. Uma boa pedida é dar uma olhada na minha apostila, para só depois voltar aqui. Confira ela aqui: <https://cantinhodor.wordpress.com/2015/03/28/a-boa-e-velha-apostila-basica-do-r/>

\ 

*********

Oi, pessoal!

Recentemente participei como instrutor de um curso fantástico sobre o R, que foi realizado com uma parceria bem legal entre o pessoal da [Bocaina Biologia da Conservação](http://biologiadaconservacao.com.br/) e a turma da [ESCAS e IPÊ](http://escas.org.br/).

Uma das coisas bem legais de se ministrar um curso de R é que sempre surgem dúvidas sobre as quais nós nunca pensamos (ou que até passaram pela nossa cabeça, mas deixamos pra lá). E aí, no meio das dúvidas que foram aparecendo entre os participantes, uma me estimulou a escrever este script.

A dúvida, bem direta era: **será que posso fazer um boxplot que mostre média e desvio padrão?**

Bom, quase todas as dúvidas no R que tratam de um "será que dá pra fazer?" são respondidas com um sim, isso vocês já sabem. A questão, quase sempre, é encontrar uma maneira prática de resolver. E é isso que vamos fazer aqui! ;)

Perceba que este script tem dois objetivos: o primeiro, e mais óbvio, é a construção de um boxplot com médias, claro. Ele pode ser útil para você, caso decida usar este tipo de gráfico um dia. Mas não acho que este seja o objetivo principal, não. Para mim, a coisa mais legal deste script é que vamos aprender a criar mais um "gráfico do zero". Vamos construir o nosso gráfico, pedaço por pedaço, e isso vai nos ensinar algumas coisas legais do funcionamento do R. Nós já fizemos um pouco disso, [quando construimos um gráfico de médias assim, "aos pedaços".](https://cantinhodor.wordpress.com/2015/10/08/graficos-de-medias-no-r-sem-pacotes/) Então vocês podem pensar neste script como uma continuação daquele, beleza?

Vamos lá!

\  

####O boxplot que já existe

Bem, você possivelmente já sabe [o que é um boxplot](https://pt.wikipedia.org/wiki/Diagrama_de_caixa). No R, ele é super fácil de se fazer, veja aqui um exemplão bem rápido, com aqueles [dados famosos que já usamos antes](https://cantinhodor.wordpress.com/2015/10/18/graficos-no-r-algumas-sugestoes-de-aprendizado/):

```{r}
#Carregando aqueles dados que já vimos antes:
data(iris)
attach(iris)
summary(iris)

#E fazendo um boxplot bem basicão:
boxplot(Petal.Width~Species, las=1, range=0)
```

Beleza, sem mistério aí, não é?

Mas, como sabemos, o boxplot tradicional usa a mediana (o traço mais forte, no centro) e os quartis (o topo e a base da caixa) em sua representação. E a função boxplot do R não apresenta outra maneira de trabalhar...

Mas, peraí, Marcos, será que podemos então, [como naquele gráfico de médias que foi feito assim, meio que do zero](https://cantinhodor.wordpress.com/2015/10/08/graficos-de-medias-no-r-sem-pacotes/), construir algo inteiramente novo?

Yes, we can! Vamos lá?

\  

####O nosso novo boxplot

Então beleza. O primeiro passo, é o mesmo do script do gráfico de médias, calcular as médias e desvios:


```{r}
médias<-tapply(Sepal.Length, Species, mean)
desvios<-tapply(Sepal.Length, Species, sd)
```

No gráfico das médias, nós criamos o gráfico com os pontos, e depois adicionamos o desvio padrão. Então temos que fazer algo mais ou menos parecido, mas começando por adicionar traços (no lugar dos pontos), para depois adicionarmos as caixinhas.

Então vamos começar criando um gráfico vazio, sem os pontos:

```{r}
x<-1:nlevels(Species)

plot(x, médias, ylim=range(c(min(Sepal.Length), max(Sepal.Length))), pch=16,
    xlab="Espécie", ylab="Comprimento das sépalas", axes=F, cex=0,
    xlim=c(0.5, nlevels(Species)+0.5))

axis(2, las=1)
axis(1, x, levels(Species))
box()

```

Sacaram a malandragem? Eu usei `cex=0` para fazer os pontos sumirem. ;)

E tem mais alguns detalhes relevantes:

* Eu usei o `ylim` para estabelecer valores máximos e mínimos do eixo y, e como ponto de partida usei os valores máximos e mínimos (calculados com `max` e `min`). O legal aqui é que não fixamos um limite numérico fixo, enetão se você for trabalhar com outro conjunto de dados, basta usar o nome da variável que você quer usar no eixo y.

* E usei o `xlim` para criar um espacinho no eixo x a mais à esquerda e à direita, senão as caixas ficariam coladas nas bordas do gráfico. Perceba que eu não usei 3.5 como limite superior: eu disse `nlevels(Species)+0.5`. Fiz isso porque se eu quiser aproveitar o script para outro exemplo, bata substituir Species pela variável relevante no outro caso.

Beleza, a "moldura" está pronta, então vamos adicionar os elementos, ok?

Vamos começar a adicionar os traços, que vão representar as medianas. Lá vai:

```{r}
plot(x, médias, ylim=range(c(min(Sepal.Length), max(Sepal.Length))), pch=16,
    xlab="Espécie", ylab="Comprimento das sépalas", axes=F, cex=0,
    xlim=c(0.5, nlevels(Species)+0.5))

axis(2, las=1)
axis(1, x, levels(Species))
box()

segments(c(0.8:nlevels(Species)), médias, c(1.2:(nlevels(Species)+0.2)), médias, lwd=2)
```

Aê, legal! Usamos ali a função `segments`, que é usada para traçar um segmento de reta no gráfico. Ela pede quatro argumentos: x1, y1, x2 e y2. Ou seja, valores iniciais e finais, em x e y. Como queremos apenas um traço horizontal, o y1 e y2 são iguais. Para o x1 e x2, usei as posições das espécies com um pequeno deslocamento para a esquerda e para a direita, de 0,2. Dá pra brincar com estes valores, claro, mas acho que deste tamanho ficou legal.

Ah, e usei o argumento `lwd` para tornar o traço mais forte, parecendo com o nosso boxplot original do R. Você pode aumentar ou diminuir o valor se quiser, alterando um pouco a estética do gráfico.


Agora, as caixinhas:

```{r}
plot(x, médias, ylim=range(c(min(Sepal.Length), max(Sepal.Length))), pch=16,
    xlab="Espécie", ylab="Comprimento das sépalas", axes=F, cex=0,
    xlim=c(0.5, nlevels(Species)+0.5))

axis(2, las=1)
axis(1, x, levels(Species))
box()

segments(c(0.8:nlevels(Species)), médias, c(1.2:(nlevels(Species)+0.2)), médias, lwd=2)

rect(c(0.8:nlevels(Species)), médias-desvios, c(1.2:(nlevels(Species)+0.2)), médias+desvios)
```

**Tcharan!** Deu certo!

Usamos, agora, a função `rect`, que cria retângulos. Ela funciona bem parecido com `segments`, e o comando fica quase igual: exceto pelos valores de y1 e y2, que vão definir a parte de baixo e a de cima da caixa.

Legal, né? :D

E aí, Marcos, podemos mexer mais? A resposta, claro, é sim! Mas desta vez vou deixar por conta de vocês, e vou ficando por aqui. Um desafio legal é tentar automatizar isso em uma função, como fizemos com o gráfico de médias. Outra coisa interessante é adicionar traços com valores externos, como um intervalo de confiança, por exemplo. AS duas coisas não são muito difíceis, e os elementos básicos para resolvê-las estão [no script do gráfico de médias](https://cantinhodor.wordpress.com/2015/10/08/graficos-de-medias-no-r-sem-pacotes/). Brinque um pouco, será um exercício legal, pode ter certeza. Boa sorte!

\ 

************

\ 

*Beleza, espero que este script seja útil. Mesmo que você não precise de um boxplot com médias, acho legal o exercício de criá-lo, pois como sempre podemos aprender coisas novas no R.*

*Abraços, e até o próximo script!*

*Prof Marcos*